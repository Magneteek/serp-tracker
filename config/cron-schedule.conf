# ORCHESTRAI SERP Tracker - Cron Job Configuration
#
# Installation:
#   1. Edit this file with your actual paths
#   2. Install cron jobs: crontab -e
#   3. Paste the cron entries below
#   4. Save and exit
#
# Verify installation: crontab -l
# View cron logs: tail -f /var/log/cron.log (or grep CRON /var/log/syslog)
#
# Cron Format: MIN HOUR DOM MON DOW COMMAND
# MIN:  0-59
# HOUR: 0-23
# DOM:  1-31 (day of month)
# MON:  1-12 (month)
# DOW:  0-7 (day of week, 0 and 7 are Sunday)

# ============================================================================
# ENVIRONMENT VARIABLES
# ============================================================================
# Set these environment variables in your crontab or in a separate env file

# Example: Load environment from file
# * * * * * . /path/to/orchestrai/.env && command

SHELL=/bin/bash
PATH=/usr/local/bin:/usr/bin:/bin
NODE_PATH=/usr/local/lib/node_modules

# ============================================================================
# DAILY JOBS - High Priority Keywords
# ============================================================================

# Track high-priority keywords daily at 2:00 AM
# This runs every day and tracks keywords with priority="high"
0 2 * * * cd /Users/kris/CLAUDEtools/ORCHESTRAI && node orchestrai-domains/seo/scripts/track-priority-keywords.js --priority high >> /Users/kris/CLAUDEtools/ORCHESTRAI/logs/serp-tracker-daily.log 2>&1

# Sync results to Notion at 2:30 AM (after tracking completes)
30 2 * * * cd /Users/kris/CLAUDEtools/ORCHESTRAI && node orchestrai-domains/seo/scripts/sync-to-notion.js >> /Users/kris/CLAUDEtools/ORCHESTRAI/logs/notion-sync-daily.log 2>&1

# ============================================================================
# WEEKLY JOBS - Medium Priority Keywords + GSC Sync
# ============================================================================

# Track medium-priority keywords every Monday at 9:00 AM
0 9 * * 1 cd /Users/kris/CLAUDEtools/ORCHESTRAI && node orchestrai-domains/seo/scripts/track-priority-keywords.js --priority medium >> /Users/kris/CLAUDEtools/ORCHESTRAI/logs/serp-tracker-weekly.log 2>&1

# Sync GSC data every Monday at 9:30 AM (last 7 days)
30 9 * * 1 cd /Users/kris/CLAUDEtools/ORCHESTRAI && node orchestrai-domains/seo/scripts/sync-gsc-data.js --all --days 7 >> /Users/kris/CLAUDEtools/ORCHESTRAI/logs/gsc-sync-weekly.log 2>&1

# Full Notion sync (all projects) every Monday at 10:00 AM
0 10 * * 1 cd /Users/kris/CLAUDEtools/ORCHESTRAI && node orchestrai-domains/seo/scripts/sync-to-notion.js --force >> /Users/kris/CLAUDEtools/ORCHESTRAI/logs/notion-sync-weekly.log 2>&1

# ============================================================================
# MONTHLY JOBS - Low Priority Keywords + Comprehensive Reports
# ============================================================================

# Track low-priority keywords on the 1st of each month at 10:00 AM
0 10 1 * * cd /Users/kris/CLAUDEtools/ORCHESTRAI && node orchestrai-domains/seo/scripts/track-priority-keywords.js --priority low >> /Users/kris/CLAUDEtools/ORCHESTRAI/logs/serp-tracker-monthly.log 2>&1

# Comprehensive GSC sync (30 days) on the 1st of each month at 11:00 AM
0 11 1 * * cd /Users/kris/CLAUDEtools/ORCHESTRAI && node orchestrai-domains/seo/scripts/sync-gsc-data.js --all --days 30 >> /Users/kris/CLAUDEtools/ORCHESTRAI/logs/gsc-sync-monthly.log 2>&1

# Archive old data (>16 months) on the 1st of each month at midnight
0 0 1 * * cd /Users/kris/CLAUDEtools/ORCHESTRAI && psql -d orchestrai_serp -c "DELETE FROM position_history WHERE date < NOW() - INTERVAL '16 months';" >> /Users/kris/CLAUDEtools/ORCHESTRAI/logs/db-cleanup.log 2>&1

# ============================================================================
# MAINTENANCE JOBS
# ============================================================================

# Database backup every day at 1:00 AM
0 1 * * * pg_dump orchestrai_serp > /Users/kris/CLAUDEtools/ORCHESTRAI/backups/serp-tracker-$(date +\%Y\%m\%d).sql

# Clean up old logs (keep last 30 days) every Sunday at 3:00 AM
0 3 * * 0 find /Users/kris/CLAUDEtools/ORCHESTRAI/logs -name "*.log" -mtime +30 -delete

# Health check - test database connection every hour
0 * * * * psql -d orchestrai_serp -c "SELECT COUNT(*) FROM tracked_keywords WHERE is_active = true;" >> /Users/kris/CLAUDEtools/ORCHESTRAI/logs/health-check.log 2>&1

# ============================================================================
# ALTERNATIVE SCHEDULES (Commented Out - Customize as needed)
# ============================================================================

# Track ALL priorities daily (high cost, use only if needed)
# 0 2 * * * cd /Users/kris/CLAUDEtools/ORCHESTRAI && node orchestrai-domains/seo/scripts/track-priority-keywords.js >> /Users/kris/CLAUDEtools/ORCHESTRAI/logs/serp-tracker-all.log 2>&1

# More frequent GSC sync (every 6 hours)
# 0 */6 * * * cd /Users/kris/CLAUDEtools/ORCHESTRAI && node orchestrai-domains/seo/scripts/sync-gsc-data.js --all --days 1 >> /Users/kris/CLAUDEtools/ORCHESTRAI/logs/gsc-sync-frequent.log 2>&1

# Track specific project only (replace PROJECT_ID)
# 0 2 * * * cd /Users/kris/CLAUDEtools/ORCHESTRAI && node orchestrai-domains/seo/scripts/track-priority-keywords.js --project PROJECT_ID >> /Users/kris/CLAUDEtools/ORCHESTRAI/logs/serp-tracker-project.log 2>&1

# ============================================================================
# NOTIFICATION INTEGRATION (Optional)
# ============================================================================

# Send daily summary email/slack notification
# 0 8 * * * cd /Users/kris/CLAUDEtools/ORCHESTRAI && node orchestrai-domains/seo/scripts/send-daily-summary.js

# ============================================================================
# NOTES
# ============================================================================
#
# 1. Log Rotation:
#    - Logs are written to /Users/kris/CLAUDEtools/ORCHESTRAI/logs/
#    - Old logs (>30 days) are automatically cleaned up
#    - Use logrotate for more advanced log management
#
# 2. Error Handling:
#    - All errors are logged to respective .log files
#    - Check logs regularly: tail -f logs/*.log
#    - Set up monitoring/alerts for failed jobs
#
# 3. Timezone:
#    - Cron uses system timezone
#    - Verify: date
#    - Change if needed: sudo timedatectl set-timezone America/New_York
#
# 4. Cost Optimization:
#    - High priority daily = ~20 keywords × $0.00075 = $0.015/day = $0.45/month
#    - Medium weekly = ~100 keywords × $0.00075 × 4 = $0.30/month
#    - Low monthly = ~500 keywords × $0.00075 = $0.375/month
#    - Total: ~$1.13/month per project
#
# 5. Customization:
#    - Adjust schedules based on your tracking needs
#    - Consider business hours for client-facing dashboards
#    - Avoid peak traffic hours for server resources
#
# ============================================================================
# QUICK REFERENCE
# ============================================================================
#
# Install cron jobs:          crontab -e (then paste the entries above)
# List current cron jobs:     crontab -l
# Remove all cron jobs:       crontab -r
# Edit cron jobs:             crontab -e
# View cron logs (macOS):     log show --predicate 'senderImagePath contains "cron"' --last 1h
# View cron logs (Linux):     grep CRON /var/log/syslog
# Test a cron job manually:   cd /path && node script.js
# Disable a job:              Comment out the line with #
#
# ============================================================================
